---
- name: Create Windows Users from File
  hosts: windows
  gather_facts: no
  tasks:
    - name: Read user data from file
      ansible.builtin.slurp:
        src: "{{ users_file }}"
      register: user_file_content

    - name: Create Windows users from file content
      win_user:
        name: "{{ item[0] }}"
        password: "{{ item[1] }}"
        state: present
        groups: "{{ item[2] }}"
        update_password: on_create
      with_items: "{{ user_data }}"
      vars:
        user_data: >-
          {{
            user_file_content.content | b64decode | splitlines | map("split", ",")
          }}
